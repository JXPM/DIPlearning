{% extends "base.html" %}

{% block content %}
<h2> Administration - Gestion des Utilisateurs</h2>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
    
    <!-- Formulaire Ajouter un Professeur -->
    <div style="background: #e6f7ff; padding: 20px; border-radius: 8px;">
        <h3> Ajouter un Professeur</h3>
        <form id="addProfForm">
            <div style="margin: 10px 0;">
                <label>Nom d'utilisateur :</label>
                <input type="text" name="username" style="width: 100%; padding: 8px;" required>
            </div>
            <div style="margin: 10px 0;">
                <label>Mot de passe :</label>
                <input type="text" name="password" style="width: 100%; padding: 8px;" required>
            </div>
            <button type="submit" class="button">‚ûï Ajouter le professeur</button>
        </form>
        <div id="profResult" style="margin-top: 10px;"></div>
    </div>

    <!-- Information √âl√®ves -->
    <div style="background: #f0ffe6; padding: 20px; border-radius: 8px;">
        <h3> Information √âl√®ves</h3>
        <p><strong>Les √©l√®ves n'ont pas besoin d'√™tre ajout√©s manuellement !</strong></p>
        <p>Ils peuvent se connecter avec n'importe quel pseudonyme.</p>
        <p>Le syst√®me cr√©era automatiquement leur compte.</p>
    </div>
</div>

<!-- Liste des Utilisateurs -->
<div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin: 20px 0;">
    <h3> Liste des Utilisateurs</h3>
    
    <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
        <thead>
            <tr style="background: #004080; color: white;">
                <th style="padding: 10px; text-align: left;">ID</th>
                <th style="padding: 10px; text-align: left;">Nom</th>
                <th style="padding: 10px; text-align: left;">R√¥le</th>
                <th style="padding: 10px; text-align: left;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr style="border-bottom: 1px solid #ddd;">
                <td style="padding: 10px;">{{ user.id }}</td>
                <td style="padding: 10px;">{{ user.username }}</td>
                <td style="padding: 10px;">
                    {% if user.role == 'eleve' %} √âl√®ve
                    {% elif user.role == 'prof' %} Professeur
                    {% elif user.role == 'super_admin' %} ‚ö° Super Admin
                    {% endif %}
                </td>
                <td style="padding: 10px;">
                    {% if user.role != 'super_admin' %}
                    <button data-user-id="{{ user.id }}" data-username="{{ user.username }}" 
                    class="delete-btn" 
                    style="background: #ff4444; color: white; padding: 5px 10px; border: none; border-radius: 4px;">
                üóëÔ∏è Supprimer
            </button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<a href="{{ url_for('dashboard') }}" class="button">‚Üê Retour au Dashboard</a>

<script>
// Ajouter un professeur
document.getElementById('addProfForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    
    fetch('/add_prof', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        const resultDiv = document.getElementById('profResult');
        if (data.success) {
            resultDiv.innerHTML = '<div style="color: green;">‚úÖ ' + data.success + '</div>';
            this.reset();
            setTimeout(() => location.reload(), 1500);
        } else {
            resultDiv.innerHTML = '<div style="color: red;">‚ùå ' + data.error + '</div>';
        }
    });
});

// Supprimer un utilisateur
function deleteUser(userId, username) {
    if (confirm('Supprimer ' + username + ' ?')) {
        fetch('/delete_user/' + userId, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('‚úÖ Supprim√© !');
                location.reload();
            } else {
                alert('‚ùå Erreur: ' + data.error);
            }
        });
    }
}
</script>
{% endblock %}